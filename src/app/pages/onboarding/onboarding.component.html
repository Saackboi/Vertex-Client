
<app-onboarding-header
  [isDarkMode]="isDarkMode"
  [notificationCount$]="notificationCount$"
  [userFullName$]="userFullName$"
  (toggleDarkMode)="toggleDarkMode()"
  (navigateToNotifications)="navigateToNotifications()"
  (logout)="logout()"
/>

<!-- Main Content -->
<main class="onboarding-main">
  <!-- Alerta de Error -->
  @if ((errorMessage$ | async)) {
    <div class="error-alert-container">
      <nz-alert
        nzType="error"
        [nzMessage]="(errorMessage$ | async)"
        nzShowIcon
        nzCloseable
        (nzOnClose)="clearError()"
        class="error-alert"
      ></nz-alert>
    </div>
  }

  <!-- Alerta de Onboarding Completado -->
  @if ((isCompleted$ | async)) {
    <app-onboarding-completed
      [accountForm]="accountForm"
      [experiences]="experiences"
      [skills]="skills"
      (navigateToDashboard)="navigateToDashboard()"
    />
  }

  <!-- Page Header -->
  <div class="page-header" [class.hidden]="(isCompleted$ | async)">
    <div class="page-title-section">
      <h1 class="page-title">Configuración de Cuenta</h1>
      @if ((isCompleted$ | async)) {
        <span class="completed-badge">
          <span nz-icon nzType="check-circle" nzTheme="fill"></span>
          Completado
        </span>
      }
    </div>
    @if ((lastSaved$ | async) && !(isCompleted$ | async)) {
      <div class="autosave-badge">
        <span nz-icon nzType="check-circle" nzTheme="outline"></span>
        <span class="badge-text">Borrador guardado automáticamente {{ (lastSaved$ | async) }}</span>
      </div>
    }
  </div>

  <!-- Stepper -->
  <div [class.hidden]="(isCompleted$ | async)">
    <app-onboarding-stepper [currentStep$]="currentStep$" />
  </div>

  <!-- Formularios de Onboarding -->
  <div [class.hidden]="(isCompleted$ | async)">
    <!-- Form Card -->
    @if ((currentStep$ | async)! === 0) {
      <app-onboarding-step-account
        [accountForm]="accountForm"
        [isLoading$]="isLoading$"
        [isSummaryTooShort]="isSummaryTooShort"
        [hasError]="hasError.bind(this)"
        [getErrorMessage]="getErrorMessage.bind(this)"
        (saveAndContinue)="saveAndContinue()"
      />
    }

  <!-- Paso 2: Experiencia -->
  @if ((currentStep$ | async)! === 1) {
    <app-onboarding-step-experience
      [experienceForm]="experienceForm"
      [experiences]="experiences"
      [experienceModalForm]="experienceModalForm"
      [isExperienceModalVisible]="isExperienceModalVisible"
      [skills]="skills"
      [isLoading$]="isLoading$"
      [hasError]="hasError.bind(this)"
      [getErrorMessage]="getErrorMessage.bind(this)"
      (addExperience)="addExperience()"
      (openExperienceModal)="openExperienceModal($event)"
      (removeExperience)="removeExperience($event)"
      (addSkill)="addSkill($event)"
      (removeSkill)="removeSkill($event)"
      (saveAndContinue)="saveAndContinue()"
      (previousStep)="previousStep()"
      (closeExperienceModal)="closeExperienceModal()"
      (saveExperienceModal)="saveExperienceModal()"
    />
  }

  <!-- Paso 3: Revisión -->
  @if ((currentStep$ | async)! === 2) {
    <app-onboarding-step-review
      [accountForm]="accountForm"
      [resumeData]="resumeData"
      [experiences]="experiences"
      [skills]="skills"
      [isLoading$]="isLoading$"
      [canFinishOnboarding]="canFinishOnboarding"
      (previousStep)="previousStep()"
      (finishOnboarding)="finishOnboarding()"
    />
  }

  </div>
  <!-- Fin Formularios de Onboarding -->

  </main>
  <!-- Footer -->
  <app-footer />
